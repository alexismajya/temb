"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const rxjs_1 = require("rxjs");
const operators_1 = require("rxjs/operators");
const options_converter_1 = require("./options-converter");
const jest_configuration_builder_1 = require("./jest-configuration-builder");
const default_config_resolver_1 = require("./default-config.resolver");
const custom_config_resolver_1 = require("./custom-config.resolver");
const jest = require('jest');
class JestBuilder {
    constructor(context) {
        this.context = context;
        this.jestConfigurationBuilder = new jest_configuration_builder_1.JestConfigurationBuilder(new default_config_resolver_1.DefaultConfigResolver(), new custom_config_resolver_1.CustomConfigResolver(context.logger));
        this.optionsConverter = new options_converter_1.OptionsConverter();
    }
    run(builderConfig) {
        const { options, root, sourceRoot } = builderConfig;
        const workspaceRoot = this.context.workspace.root;
        const configuration = this.jestConfigurationBuilder.buildConfiguration(root, sourceRoot, workspaceRoot, options.configPath);
        delete options.configPath;
        const argv = this.optionsConverter.convertToCliArgs(options);
        argv.push('--config', JSON.stringify(configuration));
        return rxjs_1.from(jest.run(argv)).pipe(operators_1.map(() => ({ success: true })));
    }
}
exports.default = JestBuilder;
//# sourceMappingURL=jest.builder.js.map